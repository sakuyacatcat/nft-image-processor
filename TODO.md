# nft-image-processor

## Use Case

- ユーザーはアプリケーションから画像をアップロードできる
- ユーザーは画像をフルオンチェーン NFT 用の画像に修正できる
- ユーザーはフルオンチェーン NFT を自分のウォレットに対して発行できる

## Features

### ユーザーはアプリケーションから画像をアップロードできる

- ユーザーは WebUI 上でアップロードフォームから画像をアップロードできる
- ユーザーは WebUI 上でアップロードした画像を確認できる

### ユーザーは画像をフルオンチェーン NFT 用の画像に修正できる

- ユーザーは WebUI 上で画像の一部をドラッグ・ドロップで指定してインペイントできる
- ユーザーは WebUI 上でドット数・カラーパレットを指定して svg 形式でドット絵化できる

### ユーザーはフルオンチェーン NFT を指定のウォレットに対して発行できる

- ユーザーは WebUI 上で自分のウォレットを接続できる
- ユーザーは WebUI 上でドット絵の svg を入力して NFT 発行できる
- ユーザーは WebUI 上で NFT 発行のトランザクションの成功を受信できる

## 機能要件一覧

frontend

- ユーザーは WebUI 上でアップロードフォームから画像をアップロードできる
  - (テストしない)画像をアップロードできる
  - (テスト)入力された画像から OriginalImage コンポーネントを作成できる
- ユーザーは WebUI 上でアップロードした画像を確認できる
  - (テストしない)OriginalImage コンポーネントを表示する

- ユーザーは WebUI 上で画像の一部をドラッグ・ドロップで指定してインペイントできる
  - (テストしない)表示された OriginalImage もしくは InpaintedImage コンポーネント上の一部を矩形範囲で指定できる
  - (テスト)矩形範囲(左上点の座標, 幅, 高さ)を入力に Crop コンポーネントを作成できる
  - (テストしない)OriginalImage もしくは InpaintedImage コンポーネント上の Crop コンポーネントで指定される矩形範囲をインペイントする
  - (テスト)インペイントした結果として新しい InpaintedImage コンポーネントを作成できる
  - (テストしない)新しい InpaintedImage コンポーネントを表示する
  - (テストしない)インペイント終了として確定できる

- ユーザーは WebUI 上でドット数・カラーパレットを指定して svg 形式でドット絵化できる
  - (テストしない)ドット数・カラーパレットをスケール・入力フォームで指定できる
  - (テスト)ドット数・カラーパレットと OriginalImage もしくは InpaintedImage コンポーネントを入力に DotImage コンポーネントを作成できる
  - (テストしない)DotImage コンポーネントを OriginalImage もしくは InpaintedImage コンポーネントと並べて表示する
  - (テストしない)ドット絵化終了として確定できる

- (テストしない)ユーザーは WebUI 上で自分のウォレットを接続できる

- ユーザーは WebUI 上でドット絵の svg を入力して NFT 発行できる
  - (テスト)ドット絵の svg 文字列を入力に NFT 発行のコントラクトを呼び出す

- (テストしない)ユーザーは WebUI 上で NFT 発行のトランザクションの成功を受信できる

contracts

- ユーザーは WebUI 上でドット絵の svg を入力して NFT 発行できる
  - (テストしない)_mint 関数を呼び出せる
  - (テスト)連長圧縮された svg 文字列を入力に svg オブジェクトを作成できる
  - (テスト)tokenId に関連付けて svg オブジェクトを保存できる
  - (テスト)svg オブジェクトを入力に svg 文字列を作成できる

- ユーザーは WebUI 上で NFT 発行のトランザクションの成功を受信できる
  - (テスト)NFT 発行のイベントを発行できる

## TODO

テスト容易性が高いものから作っていく。

- [x] 連長圧縮された svg 文字列を入力に DotImage オブジェクトを作成できる
  - [x] 入力された連長圧縮された svg 文字列が不正な長さの場合 DotImage オブジェクトの作成に失敗する
    - [x] 入力が適切な連長圧縮フォーマットであるが、32x32 ドット分の文字列でなく、1 文字足りない場合に invalidDecompressedSvgLength エラーを返す
    - [x] 入力が適切な連長圧縮フォーマットであるが、32x32 ドット分の文字列でなく、1 文字多い場合に invalidDecompressedSvgLength エラーを返す
  - [x] 入力された連長圧縮された svg 文字列が不正なフォーマットの場合 DotImage オブジェクトの作成に失敗する
    - [x] 入力の連長圧縮が空の bytes 文字列の場合に invalidDecompressedSvgFormat を返す
    - [x] 入力の連長圧縮が奇数長の bytes 文字列の場合に invalidDecompressedSvgFormat を返す
    - [x] 入力の連長圧縮に bytes 文字列に 0~F 以外の文字が含まれる場合に invalid arrayify value を返す
    - [x] 入力の連長圧縮が 0x 始まりの bytes 文字列でない場合に invalid arrayify value を返す
  - [x] 入力された連長圧縮された svg 文字列が適切な場合 DotImage オブジェクトの作成に成功する
    - [x] 入力が適切な連長圧縮フォーマットであり、32x32 ドット分の文字列の場合 DotImage オブジェクトを返す

- [x] 入力された tokenId と DotImage オブジェクトを関連付けて保存できる
  - [x] 入力された tokenId が未使用の整数であり、DotImage オブジェクトが適切な場合保存に成功する
  - [x] 入力された tokenId が有効な整数でない場合、保存に失敗する
  - [x] 入力された tokenId が使用済みの整数である場合、保存に失敗する
- [x] 入力された tokenId に関連付けられた DotImage オブジェクトを取得できる
  - [x] 入力された tokenId が有効な整数であり、関連付けられた DotImage オブジェクトが存在する場合、取得に成功する
  - [x] 入力された tokenId が有効な整数であるが、関連付けられた DotImage オブジェクトが存在しない場合、取得に失敗する
  - [x] 入力された tokenId が有効な整数でない場合、取得に失敗する
- [x] 入力された tokenId に関連付けられた DotImage オブジェクトを削除できる
  - [x] 入力された tokenId が有効であり、関連付けられた DotImage オブジェクトが存在する場合、削除に成功する
  - [x] 入力された tokenId が有効であるが、関連付けられた DotImage オブジェクトが存在しない場合、削除に失敗する
  - [x] 入力された tokenId が有効でない場合、削除に失敗する

- [ ] DotImage オブジェクトを入力に svg 文字列を作成できる
  - [ ] 適正な DotImage オブジェクトの入力から、svg 文字列の作成に成功する
  - [ ] 不正な DotImage オブジェクトの入力から、svg 文字列の作成に失敗する

- [ ] NFT 発行のイベントを発行できる
  - [ ] mint 成功時に NFT 発行のイベントが発行される
  - [ ] mint 失敗時に NFT 発行のイベントが発行されない
